<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/cadastro5.css" />
  <link rel="stylesheet" href="css/navbar.css" />
  <title>SGA - Cadastro</title>
</head>

<body>
  <div class="navbar-caixa">
    <div class="conteudo-nav">
      <div class="texto-nav">Cadastrar Novo Item</div>
      <button id="menu-btn" class="menu-btn">&#9776;</button>
    </div>
    <div id="sidebar" class="sidebar">
      <button id="close-btn" class="close-btn">&times;</button>
      <img src="imglogineusuario/senaibranco.svg" alt="" />
      <h3>Menu</h3>
      <ul>
        <li class="home"><a href="telaInicial.html" id="home"><span>Home</span></a></li>
        <li class="cadastrar"><a href="cadastro1.html" id="cadas"><span>Cadastrar</span></a></li>
        <li class="edicao"><a href="edicao.html" id="edicao"><span>Edição</span></a></li>
        <li class="estoque-item">
          <a href="#" id="esto" class="estoque-link"><span>Estoque</span></a>
          <ul id="estoque-submenu" class="submenu">
            <li><a href="catalogo.html">Catálogo</a></li>
            <li><a href="estoque_real.html">Estoque Real e Inventário</a></li>
            <li><a href="layout.html">Layout do Estoque</a></li>
          </ul>
        </li>
        <li class="financeiro"><a href="financeiro.html" id="finan"><span>Financeiro</span></a></li>
      </ul>
      <div class="container-logos">
        <h4>SGA - Sistema de Gerenciamento de Armazém</h4>
        <img src="imagens/logo-emp.svg" id="logo-gato" alt="" />
        <img src="imagens/logo-soft.svg" id="logo-cubo" />
      </div>
    </div>
  </div>

  <section class="cadastro">
    <div class="flex">
      <div class="parte-bolinhas">
        <div class="container">
          <div class="bolinha1"></div>
          <div class="palitinho1"></div>
          <div class="bolinha2"></div>
          <div class="palitinho2"></div>
          <div class="bolinha3"></div>
          <div class="palitinho3"></div>
          <div class="bolinha4"></div>
          <div class="palitinho4"></div>
          <div class="bolinha5"></div>
          <ul>
            <li>Informações Básicas</li>
            <li>Informações de Entrada</li>
            <li>Categoria</li>
            <li>Especificações</li>
            <li>Adicional</li>
          </ul>
        </div>
        <div class="caixa-aberta">
          <img src="imgCADASTRO/CaixaFechada.svg" alt="" />
        </div>
      </div>

      <div class="inserir-info">
        <div class="container">
          <div class="porcentagem-linha">
            <div class="linha-verde"></div>
          </div>

          <p>100%</p>
          <div class="divisoria"></div>

          <form id="form-etapa5">
            <div class="Adicional">
              <h1>Adicional</h1>
              <div class="imagem">
                <div class="image-upload">
                  <label for="image-input">Imagem</label>
                  <input type="file" id="image-input" name="imagem" accept="image/*" />
                  <img id="uploaded-image" src="" alt="Uploaded Image" />
                </div>
              </div>
              <div class="caixaTexto">
                <textarea style="resize: none" id="observacao" placeholder="Observação Adicional" required></textarea>
              </div>
            </div>

            <div class="setas">
              <button type="button" id="esquerda" onclick="location.href='cadastro4.html';">
                <img src="imgCADASTRO/setaESQUERDA.svg" alt="" />
              </button>
            </div>
            <div class="salvar">
              <button type="submit" id="salvar">SALVAR</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="footer">
      <img src="imgCADASTRO/gatinhoRodapé.svg" alt="" />
    </div>
  </section>

  <script src="js/navbar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.getElementById("form-etapa5").addEventListener("submit", async function (e) {
    e.preventDefault();

    const dados = JSON.parse(localStorage.getItem("cadastro_produto")) || {};
    const imagemInput = document.getElementById("image-input");
    const observacao = document.getElementById("observacao").value;

    const formData = new FormData();

    try {
      formData.append("codigo", parseInt(dados.codigo));
      formData.append("nome_basico", dados.nome_basico);
      formData.append("nome_modificador", dados.nome_modificador);
      formData.append("descricao_tecnica", dados.descricao_tecnica || "");
      formData.append("fabricante", dados.fabricante || "");
      formData.append("unidade", dados.unidade || "");
      formData.append("preco_de_venda", parseFloat(dados.preco_de_venda));
      formData.append("fragilidade", String(dados.fragilidade)); // "true" ou "false"
      formData.append("rua", parseInt(dados.rua));
      formData.append("coluna", parseInt(dados.coluna));
      formData.append("andar", parseInt(dados.andar));
      formData.append("altura", parseFloat(dados.altura));
      formData.append("largura", parseFloat(dados.largura));
      formData.append("profundidade", parseFloat(dados.profundidade));
      formData.append("peso", parseFloat(dados.peso));
      formData.append("observacoes_adicional", observacao);
      formData.append("inserido_por", localStorage.getItem("usuario_email"));

      if (imagemInput.files[0]) {
        formData.append("imagem", imagemInput.files[0]);
      }

      console.log("FormData enviado:");
      for (const [key, value] of formData.entries()) {
        console.log(`${key}:`, value);
      }

      const response = await fetch("http://127.0.0.1:8000/api/produtos", {
        method: "POST",
        body: formData,
      });

      const result = await response.json();

      if (response.ok) {
        Swal.fire({
          icon: "success",
          title: "Produto cadastrado com sucesso!",
          showConfirmButton: false,
          timer: 1500,
        }).then(() => {
          localStorage.removeItem("cadastro_produto");
          location.href = "telaInicial.html";
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "Erro ao cadastrar",
          text: result.detail || "Erro desconhecido.",
        });
      }
    } catch (error) {
      console.error("Erro:", error);
      Swal.fire({
        icon: "error",
        title: "Erro",
        text: "Erro ao enviar o formulário.",
      });
    }
  });
</script>

</body>

</html>